# ================================
# Fincado â€“ Complete Configuration
# Security, Speed, AdSense & SEO
# ================================

# 1. ENABLE COMPRESSION
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json application/xml image/svg+xml
</IfModule>

# 2. BROWSER CACHING
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/webp "access plus 1 year"
  ExpiresByType image/svg+xml "access plus 1 year"
  ExpiresByType text/css "access plus 1 year"
  ExpiresByType text/javascript "access plus 1 year"
  ExpiresByType text/html "access plus 1 hour"
</IfModule>

<Files "f79d7e3caed6497cafbcc9ee2cd99a55.txt">
  Header set Cache-Control "no-store, no-cache, must-revalidate, max-age=0"
</Files>

# 3. SECURITY HEADERS
<IfModule mod_headers.c>
    Header set Strict-Transport-Security "max-age=63072000; includeSubDomains; preload"
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set Referrer-Policy "origin-when-cross-origin"
    
    # CSP - Optimized for AdSense/Analytics
    Header set Content-Security-Policy "default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' https:; style-src 'self' 'unsafe-inline' https:; img-src 'self' data: https:; font-src 'self' data: https:; frame-src 'self' https:; connect-src 'self' https: wss:;"
</IfModule>

# ================================
# 4. SEO REDIRECTS & ROUTING
# ================================
RewriteEngine On

# --- FIX: Force Trailing Slash (With Anti-Loop & IndexNow Protection) ---
# 1. If it's NOT a real file
RewriteCond %{REQUEST_FILENAME} !-f
# 2. And it does NOT end in a slash
RewriteCond %{REQUEST_URI} !/$
# 3. And it is NOT an .html file (This stops the infinite loop!)
RewriteCond %{REQUEST_URI} !\.html$
# 4. And it is NOT a .txt file (Safeguard for IndexNow/Robots.txt)
RewriteCond %{REQUEST_URI} !\.txt$
RewriteRule ^(.*)$ /$1/ [L,R=301]

# --- Calculator Cleanups ---
Redirect 301 /home-loan-calculator /loans/home-loan/
Redirect 301 /personal-loan-calculator /loans/personal-loan/
Redirect 301 /car-loan-calculator /loans/car-loan/
Redirect 301 /education-loan-calculator /loans/education-loan/
Redirect 301 /mutual-fund-calculator /mutual-funds/
Redirect 301 /ssy-calculator /sukanya-samriddhi/
Redirect 301 /step-up-sip-calculator /sip-calculator/
Redirect 301 /retirement-plan /retirement-calculator/
Redirect 301 /credit-score-calculator /credit-score/

# --- Guide Fixes ---
Redirect 301 /guides/home-loan-for-first-time-buyers /guides/home-loan-first-time-buyers/
Redirect 301 /guides/personal-loan-interest-rates /loans/personal-loan/
Redirect 301 /guides/sip-investment-strategies /guides/sip-investment-guide/
Redirect 301 /guides/credit-score-guide-india /guides/how-credit-score-works-india/
Redirect 301 /guides/emi-calculator-guide-2025 /guides/emi-calculator-guide/

# --- General ---
Redirect 301 /privacy /privacy-policy/
Redirect 301 /faq /faqs/

# ================================
# 5. STATIC FILE HANDLING (Next.js Export)
# ================================

# If the request matches a real file or directory, serve it directly
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# Internal Rewrite: Map folder/ to folder/index.html
# Only if the index.html actually exists (Prevents 404 loops)
RewriteCond %{REQUEST_URI} \/$
RewriteCond %{DOCUMENT_ROOT}/$1/index.html -f
RewriteRule ^(.*)/$ $1/index.html [L]

# Clean URL Map: If /about requested, try /about.html
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(.*)$ $1.html [L]

# 404 Fallback
ErrorDocument 404 /404.html